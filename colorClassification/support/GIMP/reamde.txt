/* ***************************************************** */
/*      ------ Colour Classification on Gimp2 ------     */
/*                                  sin@Asura-fit --     */
/*                                   Dec 29, 2008 --     */
/* ***************************************************** */



0 はじめに
　これまでPhotoshopで色きりの作業をしてきたけれど、ライセンス的にもヤ
バいし処理が重いということで、思いきってGimpに移行しようということに
なった。んなわけで、Gimpでの環境構築と色きりのやり方をまとめておく。
　ところで書いてるsinはwinユーザなので、macでディレクトリがどうなって
るかは分からない。だからマッカーな人はディレクトリを置き換えて読んでね！
　と、いうわけでCCOG(GIMP2で色きり)の解説はじまるます。ぽえーん。

　　　　　　 △／
　　　　　 __／▽
　　　　／_ ￣_＼
　　　⊥　･　 ・ ⊥
　　　十　 (＿)  十
　　　｜　 　　　　 Ｌ､
　　 ⊂／￣￣`―´



1 準備
1.1 用意するもの
-Gimp2.0
-このZip [CCWilber]
--CC4Gimp.txt	//この"れあもで"ファイル
--asura-create-layers.scm	//色きり用レイヤ作成スクリプトFoooooooooooo!!
--AsuraColor.gpl	//Asuraカラーのパレット
--ps-menurc	//ショートカットキーのPhotoshop配列(オプショナル)
-キアイ

1.2 環境をととのえる
　まずGimpをインストールするところから。
	http://www.gimp.org/
ここからGimpの最新版をダウンロードし、インストールする。
終わったらとりあえず起動し、「Gimp今日の技」のダイアログを閉じる。

　次のディレクトリを開く
	C:\documents and settings\[ユーザ]\.gimp-x.x\　　　(x.xはgimpのバージョン)
次にパレット、Script-Fuを使えるようにする。
	palettes\　に　AsuraColor.gpl
	scripts\　に　asura-create-layers.scm
をコピーする。

　今までphotoshopを使っていてショートカットキーがキモい！！　という人は、
	[GIMPをインストールしたディレクトリ]\etc\gimp\x.x\　　　(x.xはgimpのバージョン)
にps-menurcをブチこもう！　完全じゃないけどphotoshopふうになるよ！



2 色きり
　準備がととのったら、Gimpでじっさいに色きりをする。
基本的には、

Gimpで開く
　　↓
CreateLayersする
　　↓
色きり(ここがもっとも深遠)
　　↓
いったんGimp形式(.xcf)で保存
　　↓
ppm形式で保存
　　↓ (ここから先は一応色きりマスダーの仕事？)
すべてのファイルをかき集め、定められたディレクトリにまとめる
　　↓
threshする
　　↓
結果、normal2.tmができる

...という流れ。

2.1 下準備
　BallならBallフォルダの、GoalならGoalフォルダのrgbimage.ppmを
Gimpアイコン(とかGIMPのツールボックスとかメインウィンドウとか)に
ドラッグ&ドロップする。
　そしてフィルタ->AsuraCreateLayersを選択。レイヤがいっぱいできたら、
背景(切る画像)を選択する。
　これで下準備完了。


2.2 色きり
　ツールボックスの中から「ファジー選択」ツールを選ぶ。photoshopキーに
してるなら、従来通り"w"で切り替わる。
　ツールボックス下のオプションでモードを「選択範囲に加える」にし、
「アンチエイリアス」と「境界をぼかす」のチェックをはずす。しきい値は
15くらいがいいかもね。
　　　*)ツールのオプションは起動毎に初期化されちゃうので、ツールボックス
　　　　最下部のボタンで設定を保存しておくといいかも。

　ズームするならズームして(photoshopキーなら"z")、ボールならボール、
フィールドならフィールドの色を元画像で選択していく。しおえたら対応する
レイヤをえらんで、パレットの"AsuraColor"から対応する色をドラッグ&ドロップ。
すると色が塗られる。
　これをオブジェクト分くりかえし。

2.3 色きりｵﾜﾀ
　終わったら、元画像と同じディレクトリに"label.xcf"(GIMPフォーマット)で保存。
次に名前をつけて保存で"label.ppm"で保存。レイヤが云々のメッセージはスルーする。
　あとは責任者に提出だ！


3 threshについて
　makefileを読めば分かるけど、カラーテーブルの作成には結局のところそれぞれの
label.ppmを使う。label.ppmがなければirfanViewを通してlabel.psdから変換する。
なので、切った結果をppmとして出力できればソフトは何でもOKということ。
　threshの学習エンジンももっと精度のいいのにしようぜということでseyからも
要望でてるのでみんながんばろうな！！


4 さいごに
　とりあえずオープンソースでかなりの性能をもつGIMPでやってみたけど、Script-Fuが
ネックだった。GIMPの提供するプロシージャが少ないしスマートじゃないぜ。まわりくどい。
そこんとこどうにかなってほしいなあ。

5 ホントさいごに
　Wilberサイコー！！